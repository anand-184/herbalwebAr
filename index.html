<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Herbal Garden AR</title>

    <!-- A-Frame and AR.js -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ar.js@1.7.2/aframe/build/aframe-ar.min.js"></script>

    <style>
        body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; }
        #controls {
            position: absolute; top: 10px; left: 10px; z-index: 10;
            display: flex; flex-direction: column; gap: 10px;
        }
        #plantSelector, #addModelButton {
            padding: 10px; font-size: 16px; background: white;
            border: 1px solid black; border-radius: 5px; cursor: pointer;
        }
    </style>
</head>
<body>

    <!-- Controls -->
    <div id="controls">
        <select id="plantSelector">
            <option value="models/Plant.glb">üåø Tulsi</option>
            <option value="models/Coffee_plant.glb">‚òï Coffee</option>
            <option value="models/rosemary.glb">üå± Aloe Vera</option>
            <option value="models/shelf_plants.glb">‚òòÔ∏è Shelf Plants</option>
            <option value="models/Flower_Pot.glb">ü™¥ Flower Pot</option>
        </select>
        <button id="addModelButton">‚ûï Add New Plant</button>
    </div>

    <!-- AR Scene -->
    <a-scene embedded arjs="sourceType: webcam; facingMode: environment; debugUIEnabled: false;">
             
        <!-- AR Camera -->
        <a-camera gps-camera rotation-reader></a-camera>

        <!-- Lighting -->
        <a-entity light="type: directional; intensity: 1.2" position="1 3 3"></a-entity>
        <a-entity light="type: ambient; intensity: 0.5"></a-entity>

        <!-- Main plant model  -->
        <a-entity id="plantModel" position="0 0 -2" scale="1 1 1"
                  gltf-model="models/House_Plant.glb">
        </a-entity>

        <!-- Container for multiple plants -->
        <a-entity id="plantsContainer"></a-entity>

    </a-scene>

    <script>
        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                console.log("Camera access granted:", stream);
            } catch (error) {
                console.error("Camera access denied:", error);
                alert("Please enable camera permissions in settings.");
            }
        }

        // Automatically request camera permissions
        window.onload = startCamera;

        let plantSelector = document.getElementById("plantSelector");
        let addModelButton = document.getElementById("addModelButton");
        let plantsContainer = document.getElementById("plantsContainer");

        function createPlantModel(selectedPlant) {
    let newPlant = document.createElement("a-entity");

    // Generate random positions with a wider range
    let randomX = (Math.random() * 4 - 2).toFixed(2);  // Range: -2 to 2
    let randomZ = (Math.random() * 4 - 3).toFixed(2);  // Range: -3 to 1
    let randomY = (Math.random() * 0.5).toFixed(2);    // Slight height variation

    newPlant.setAttribute("gltf-model", selectedPlant);
    newPlant.setAttribute("position", `${randomX} ${randomY} ${randomZ}`);
    newPlant.setAttribute("scale", "0.5 0.5 0.5");
    newPlant.setAttribute("rotation", `0 ${Math.random() * 360} 0`); // Random rotation
    newPlant.setAttribute("class", "plant");

    plantsContainer.appendChild(newPlant);
    console.log("Added new model at:", randomX, randomY, randomZ);
}

        addModelButton.addEventListener("click", function() {
            let selectedPlant = plantSelector.value;
            createPlantModel(selectedPlant);
        });
    </script>

</body>
</html>
